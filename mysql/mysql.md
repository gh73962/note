# Mysql
## 索引 B+树
B+树的索引分为聚集索引和非聚集索引,其不同点是叶子节点是否  是完整的行数据       
Innodb的存储引擎表是索引组织表,表数据按主键顺序排放,聚集索引就是按照每张表的主键构造一颗b+树,叶子节点存放的是表的完整行记录; 非聚集索引的叶子节点不包含完整行记录的全部数据.        
Innodb的非聚集索引叶子节点内容为主键索引值      
在没有主键时 Innodb 会给数据表的每条记录生成一个 6 个字节长度的 RowId 字段，会以此建立聚集索引。        

## 回表
通过其他索引(非主键索引)查询时回到主键索引树搜索的过程。避免回表操作是提升 SQL 查询效率的常规思路及重要方法。       
避免回表, 索引覆盖      

## 索引下推
通过普通索引查询时,当有额外的条件时,在当前索引内完成条件判断,不再回表
索引下推在非主键索引上的优化，可以有效减少回表的次数，大大提升了查询的效率。

## MRR优化
multi range read优化目的是减少磁盘的随机访问,并将随机访问转化为顺序访问     
对于 Innodb，则会按照聚簇索引键值排好序，再顺序的读取聚簇索引。     

## 常见索引失效
1.  范围查询（>,<,<>）
2.  查询条件类型不一致
3.  查询条件使用了函数
4.  模糊查询
5.  不使用组合索引的首个字段当条件


## B树和B+树的不同
1.  B 树一个节点里存的是数据，而 B+树存储的是索引（地址）。
2.  B+树的叶子节点是数据阶段用了一个链表串联起来，便于范围查找。

## 事务
原子性：将所有 SQL 作为原子工作单元执行，要么全部执行，要么全部不执行       
一致性：事务完成后，所有数据的状态都是一致的        
隔离性：如果有多个事务并发执行，每个事务作出的修改必须与其他事务隔离        
持久性：即事务完成后，对数据库数据的修改被持久化存储        

脏读:读到了其他事务未提交的数据
不可重复读:同一个事务中,读到了另一个事务update的数据(针对的是值的不同)
幻读:同一个事务中，读到了另一个事务 insert 的数据 (数据条数的不同)

## 锁
行级锁
表级锁
页级锁
悲观锁:依赖锁,默认数据一定会冲突
乐观锁:并不会使用锁,而是在提交更新数据时检查冲突,有冲突则报错,让外部选择处理